version: "3.3"

volumes:
  traefik-ssl-certs:
    driver: local

services:
  traefik.rproxy:
    image: "traefik:latest"
    container_name: traefik.rproxy
    restart: always 
      
    ports:
      - "80:80"
      - "443:443"
      - "853:853"

    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "./traefik-ssl-certs:/ssl-certs"
      - "./configurations/:/configurations"
      - "./configurations/:/etc/traefik/"      

    labels:
      - "traefik.enable=true"

      - "traefik.http.routers.traefik-secure.rule=Host(`traefik.cloud-migrations.nl`)"
      - "traefik.http.routers.traefik-secure.tls.certresolver=production"
      - "traefik.http.routers.traefik-secure.tls=true"
      - "traefik.http.routers.traefik-secure.entrypoints=web-secure"
      - "traefik.http.routers.traefik-secure.service=api@internal"
      - "traefik.http.routers.traefik-secure.middlewares=authelia-secure@docker"

    networks:
      - web-secure
      - web

networks: 
  web-secure:
    external: true
  web:
    external: true
